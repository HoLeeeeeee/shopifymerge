{% liquid
  assign secid = section.id | split:"__" 
  assign secidlast = secid[1] | replace: "-","_"
%}
<style>
  #spmoredevices-out-{{ secidlast }}{
    {% if section.settings.bg_image %}
      background: url("{{ section.settings.bg_image | image_url }}") no-repeat;
      background-size: 100% auto;
      background-position: center top;
    {% endif %}
  }

 {% if section.settings.bg_imagemb %}
  @media (max-width:768px){
     #spmoredevices-out-{{ secidlast }}{
      background-image: url("{{ section.settings.bg_imagemb | image_url }}");
      background-position: top;
    background-size: auto;
  } 
  }
 {% endif %}
</style>
<div id="spmoredevices-out-{{ secidlast }}">
<div class="spmoredevices-outbox">
   
  <div class="contain-index">
    {% if section.settings.title != blank %}
        <div class="spmoredevices-toptitle animate-ele">{{ section.settings.title }}</div> 
        {% endif %}    
    
    <div class="spmoredevices-content animate-ele">
      <div class="spmoredevices-pros">
        {% for block in section.blocks %} 
         {% liquid
            assign product = all_products[block.settings.product]
            assign current_variant = product.selected_or_first_available_variant
           assign product_gw = all_products[block.settings.product_gw]
          %}

       <div class="spmoredevices-proitem">
         {% if block.settings.save != blank %}
         <div class="spmoredevices-savepc">SAVE<span>{{  block.settings.save }}</span></div> 
         {% endif %}
          <div class="spmoredevices-proitem-img"> 
            {% if block.settings.image %}
            <a href="{{ product.url }}"><img src="{{ block.settings.image | img_url:'master' }}" /></a>
            {% endif %}
          </div>       
         <div class="spmoredevices-itemtext">
         {% if block.settings.title != blank %}
         <div class="spmoredevices-title">{{  block.settings.title }}</div>
         {% endif %}
          <div class="spmoredevices-proinfo">
            <div class="spmde-proif-left"> 
           {% if block.settings.combo != blank %}
             <div class="spmde-proif-leftcombo">{{  block.settings.combo }}</div>
           {% endif %}
              {% assign idvalue = block.id | prepend:'spofdevform' %}
{% form 'product', product, id: idvalue, class: 'product-single__form' %}

    <div class="payment-buttons">
    <span class="spoffer-ubybutton bthho spoffer-ubybutton02"><span>Shop Now</span></span>
    <button
      {% if product.empty? %}type="button"{% else %}type="submit"{% endif %}
      data-product-id="{{ current_variant.id }}"
      name="add"
      data-add-to-cart
      class="add-to-cart add-to-cartfeapro addcartcustom js-drawer-open-cart"
      {% unless current_variant.available %} disabled="disabled"{% endunless %}>
      <span data-add-to-cart-text>
        Add To Cart
      </span>
    </button>
      
    </div>
    
      <select name="id" data-product-select class="product-single__variants no-js">
        {%- for variant in product.variants -%}
          {% if variant.available %}
            <option {% if variant == product.selected_or_first_available_variant %}
              selected="selected" {% endif %}
              value="{{ variant.id }}">
              {{ variant.title }} - {{ variant.price | money_with_currency }}
            </option>
          {% else %}
            <option disabled="disabled">
              {{ variant.title }} - {{ 'products.product.sold_out' | t }}
            </option>
          {% endif %}
        {%- endfor -%}
      </select>
    {% endform %} 
       <script>
   if(shopify_features_script){
   }else{let shopify_features_script = document.querySelector("script[id='shopify-features']"); let shopify_features_json = JSON.parse(shopify_features_script.innerHTML);}
         
  
 
  var checkout_headers = {
  'Accept': 'application/json',
  'Content-Type': 'application/json',
  'authorization': 'Basic ' + btoa(shopify_features_json.accessToken)
  };
  $(".spoffer-ubybutton02").click(function(){

  let variant_id={{current_variant.id}};

  let checkout_json={
  "checkout": {
  "line_items": [
  {
  "variant_id": variant_id,
  "quantity": 1
  }
  ],
  "secret": true,
  "wallet_name": "Checkout",
  "is_upstream_button": false,
  "page_type": "product",
  "has_selling_plans": false,
  "presentment_currency": "{{ shop.currency }}",
  "country": "{{shop.locale|upcase}}"
  }
  }
  let data=JSON.stringify(checkout_json);
  fetch("/wallets/checkouts.json",
  {
  method: 'POST',
  headers: checkout_headers,
  body: data
  }
  ).then(function(response) {
  if (response.ok) {
  return response.text();
  }
  }).then(function(strj) {
  let checkout_json = JSON.parse(strj);
  location.href = checkout_json.checkout.web_url;
  }).catch(function(err) {
  });
  })
</script>       
            </div>
            
           <div class="spmde-proif-right">
             <div class="spmde-proif-rprice">
              {% if block.settings.newprice != blank %}
             <span class="spmde-proif-newprice">{{  block.settings.newprice }}</span>
              {% endif %}{% if block.settings.oldprice != blank %}
             <span class="spmde-proif-oldprice">{{  block.settings.oldprice }}</span>
              {% endif %}
             </div>
             <div class="devices-giveawaybox">
               <img class="devices-gbox-tag" alt src="https://cdn.shopify.com/s/files/1/0558/0708/2629/files/devices_2.png?v=1711523768"/>
               {% if block.settings.product_gw %}<a href="{{ product_gw.url }}">{% endif %}
               <div class="devices-gbox-teim">{% if block.settings.imagegw %}<span class="devices-gbox-img"><img src="{{ block.settings.imagegw | img_url:'master' }}" /></span>{% endif %}{% if block.settings.gawaytitle != blank %}<span class="devices-gbox-title">{{ block.settings.gawaytitle }}</span>{% endif %}</div>
              {% if block.settings.product_gw %}</a>{% endif %}
               {% if block.settings.gawayvalue != blank %}
             <div class="spmde-proif-gawayvalue"> Valued at<span>{{ block.settings.gawayvalue }}</span></div>
              {% endif %}
             </div>
             
           </div>
            
          </div>

         </div>
         </div>   
     {% endfor %}

      </div>
    </div>
    

  </div>
</div>
</div>
{% schema %}
  {
   "name": "More Devices",
  "settings": [
     {
        "type": "text",
        "id": "title",
        "label": "title?"
      },
    {
      "type": "image_picker",
      "id": "bg_image",
      "label": "Background Image"
    },
    {
      "type": "image_picker",
      "id": "bg_imagemb",
      "label": "Background Image(mobile)"
    }
    ],
    "blocks": [
      {
        "type": "block",
        "name": "block",
        "settings": [
       {
        "type": "text",
        "id": "save",
        "label": "save"
      },{
        "type": "image_picker",
        "id": "image",
        "label": "image"
      },{
        "type": "product",
        "id": "product",
        "label": "product"
      },{
        "type": "text",
        "id": "title",
        "label": "title"
      },{
        "type": "text",
        "id": "combo",
        "label": "combo"
      },{
        "type": "text",
        "id": "newprice",
        "label": "now price"
      },{
        "type": "text",
        "id": "oldprice",
        "label": "old price"
      },{
        "type": "header",
        "content": "giveaway"
      },{
        "type": "product",
        "id": "product_gw",
        "label": "givwaway product"
      },{
        "type": "image_picker",
        "id": "imagegw",
        "label": "giveaway image"
      },{
        "type": "text",
        "id": "gawaytitle",
        "label": "giveaway title"
      },{
        "type": "text",
        "id": "gawayvalue",
        "label": "giveaway value"
      }
        ]
      }
    ],
    "presets": [
      {
        "name": "More Devices",
        "category": "HO-layout"
      }
    ]
  }
{% endschema %}
